<div
  class="modal fade"
  id="themesModal"
  tabindex="-1"
  aria-hidden="true"
  x-data="themesLogic()"
  x-init="init()"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Site Themes</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Select Theme</label>
          <select class="form-select" x-model="selectedTheme">
            <template x-for="t in themes" :key="t.id">
              <option :value="t.id" x-text="t.name"></option>
            </template>
          </select>
        </div>

        <hr>
        <h6>Theme Configuration</h6>

        <div class="mb-3">
          <label class="form-label">Site Title</label>
          <input type="text" class="form-control" x-model="config.siteTitle">
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea class="form-control" rows="2" x-model="config.siteDescription"></textarea>
        </div>

        <div class="mb-3" x-show="selectedTheme === 'store'">
          <label class="form-label">Store Owner Email</label>
          <input type="email" class="form-control" x-model="config.storeEmail" placeholder="orders@myshop.com">
          <div class="form-text small">Used for receiving order inquiries via email.</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Color Palette</label>
          <div class="d-grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));">
            <template x-for="(p, key) in palettes" :key="key">
              <div 
                class="border rounded p-2 cursor-pointer position-relative"
                :class="config.paletteId === key ? 'border-primary ring-2' : 'border-light'"
                @click="config.paletteId = key"
                style="cursor: pointer;"
              >
                <div class="d-flex mb-2" style="height: 20px;">
                  <div class="flex-grow-1" :style="`background: ${p.primary}`"></div>
                  <div class="flex-grow-1" :style="`background: ${p.secondary}`"></div>
                  <div class="flex-grow-1" :style="`background: ${p.bg}`"></div>
                </div>
                <div class="small text-center text-truncate" x-text="p.name"></div>
                <div x-show="config.paletteId === key" class="position-absolute top-0 end-0 p-1 text-primary">
                  <i class="bi bi-check-circle-fill"></i>
                </div>
              </div>
            </template>
          </div>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-6">
            <label class="form-label small">Font Family</label>
            <select class="form-select form-select-sm" x-model="config.fontFamily">
              <option value="system-ui, -apple-system, sans-serif">System UI</option>
              <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
              <option value="'Helvetica Neue', Helvetica, Arial, sans-serif">Helvetica</option>
              <option value="'Georgia', serif">Georgia</option>
              <option value="'Courier New', Courier, monospace">Courier New</option>
              <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
              <option value="'Arial Black', sans-serif">Arial Black</option>
            </select>
          </div>
          <div class="col-6">
            <label class="form-label small">Border Radius</label>
            <select class="form-select form-select-sm" x-model="config.borderRadius">
              <option value="0px">None (0px)</option>
              <option value="4px">Small (4px)</option>
              <option value="8px">Medium (8px)</option>
              <option value="16px">Large (16px)</option>
              <option value="9999px">Round</option>
            </select>
          </div>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-6">
            <label class="form-label small">Layout Style</label>
            <select class="form-select form-select-sm" x-model="config.layoutStyle">
              <option value="default">Default</option>
              
              <!-- Writer Options -->
              <template x-if="selectedTheme === 'writer'">
                <optgroup label="Writer Options">
                  <option value="sidebar">Sidebar</option>
                  <option value="grid">Grid</option>
                </optgroup>
              </template>

              <!-- Portfolio Options -->
              <template x-if="selectedTheme === 'portfolio'">
                <optgroup label="Portfolio Options">
                  <option value="grid">Full Grid</option>
                  <option value="minimal">Minimal List</option>
                </optgroup>
              </template>

              <!-- Store Options -->
              <template x-if="selectedTheme === 'store'">
                <optgroup label="Store Options">
                  <option value="list">List View</option>
                  <option value="featured">Featured Hero</option>
                </optgroup>
              </template>

              <!-- Landing Options -->
              <template x-if="selectedTheme === 'landing'">
                <optgroup label="Landing Options">
                  <option value="centered">Centered Hero</option>
                  <option value="split">Split Screen</option>
                </optgroup>
              </template>
            </select>
          </div>
          <div class="col-6">
            <label class="form-label small">Design Variant</label>
            <select class="form-select form-select-sm" x-model="config.designVariant">
              <option value="default">Default</option>
              <option value="flat">Flat / Minimal</option>
              <option value="glass">Glassmorphism</option>
              <option value="neumorphic">Soft / Neumorphic</option>
              <option value="retro">Retro / Brutalist</option>
            </select>
          </div>
        </div>

        <!-- Extra Pages (Writer Theme Only) -->
        <div class="mb-3" x-show="selectedTheme === 'writer'">
          <label class="form-label">Extra Pages</label>
          <div class="alert alert-light border small mb-2" x-show="!config.extraPages || config.extraPages.length === 0">
            No extra pages added. Click below to add pages like "About" or "Contact".
          </div>
          <template x-for="(page, index) in config.extraPages" :key="index">
            <div class="border p-3 mb-3 rounded bg-light position-relative">
              <button type="button" class="btn-close position-absolute top-0 end-0 m-2" aria-label="Remove" @click="config.extraPages.splice(index, 1)"></button>
              <div class="mb-2">
                <label class="form-label small">Page Title</label>
                <input type="text" class="form-control form-control-sm" x-model="page.title" placeholder="e.g. About Me">
              </div>
              <div>
                <label class="form-label small">Content (Markdown)</label>
                <textarea class="form-control form-control-sm font-monospace" rows="5" x-model="page.content" placeholder="# About Me&#10;&#10;I am a writer..."></textarea>
              </div>
            </div>
          </template>
          <button type="button" class="btn btn-sm btn-outline-primary" @click="if(!config.extraPages) config.extraPages = []; config.extraPages.push({title: '', content: ''})">
            <i class="bi bi-plus-lg"></i> Add Page
          </button>
        </div>

        <div class="alert alert-info small">
          Applying a theme will overwrite <code>index.html</code> and
          <code>swp/</code> folder in your repository root.
          It will also rebuild <code>articles.json</code>.
        </div>

        <div
          class="alert"
          :class="status.includes('Error') ? 'alert-danger' : 'alert-success'"
          x-show="status"
          x-text="status"
        ></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-primary"
          @click="applyTheme"
          :disabled="loading || !repoName"
        >
          <span
            class="spinner-border spinner-border-sm"
            x-show="loading"
          ></span>
          Apply Theme
        </button>
      </div>
    </div>
  </div>
</div>
